<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex, nofollow" />
    <title>Page with Kameleoon</title>
    <meta property="og:title" content="Page with Kameleoon" />
    <meta name="keywords" content="demo, tag manager" />
    <link href="/css/output.css" rel="stylesheet" />

    <script id="__EDGEE_SDK__" async src="https://demo.edgee.app/_edgee/sdk.js"></script>
    <script src="/p6cdkf9c3m/sdk.js"></script>
  </head>
  <body class="min-h-screen bg-background font-sans antialiased">
    <nav class="bg-gray-800">
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="flex h-16 items-center justify-between">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <a href="/">
                <svg width="30" height="30" viewBox="0 0 512 512" fill="#FFFFFF">
                  <path
                    d="M250.89 62.0864C253.362 56.5582 258.844 53 264.891 53H418.643C429.762 53 437.187 64.4799 432.643 74.6453L413.509 117.45C411.038 122.978 405.555 126.537 399.509 126.537H245.757C234.638 126.537 227.212 115.057 231.756 104.891L250.89 62.0864Z"
                  />
                  <path
                    d="M97.4909 228.916C99.962 223.387 105.445 219.829 111.491 219.829H297.019C308.138 219.829 315.563 231.309 311.019 241.475L291.885 284.279C289.414 289.808 283.931 293.366 277.885 293.366H92.3574C81.2382 293.366 73.8128 281.886 78.3568 271.721L97.4909 228.916Z"
                  />
                  <path
                    d="M97.4909 393.55C99.962 388.022 105.445 384.463 111.491 384.463H367.144C378.263 384.463 385.689 395.943 381.145 406.109L362.011 448.914C359.54 454.442 354.057 458 348.01 458H92.3574C81.2382 458 73.8128 446.52 78.3568 436.355L97.4909 393.55Z"
                  />
                </svg>
              </a>
            </div>
            <div class="ml-6 block">
              <div id="nav" class="flex space-x-4">
                <a
                  href="/ab-testing-kameleoon.html"
                  class="rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white"
                >
                  Kameleoon
                </a>
                <a
                  href="/ab-testing-kameleoon-with-edgee.html"
                  class="rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white"
                >
                  Kameleoon with Edgee
                </a>
              </div>
              <script>
                document.addEventListener("DOMContentLoaded", function () {
                  var currentUrl = window.location.pathname;
                  if (currentUrl === "/index.html") {
                    currentUrl = "/";
                  }
                  var links = document.querySelectorAll("#nav a");
                  links.forEach(function (link) {
                    if (link.getAttribute("href") === currentUrl) {
                      link.classList.add("bg-gray-900");
                    }
                  });
                });
              </script>
            </div>
          </div>
          <div class="flex items-center">
            <div class="flex items-center">
              <a href="https://github.com/edgee-cloud/demo-html" target="_blank" class="text-sm font-medium text-gray-300 hover:text-white">
                <svg width="24" height="24" viewBox="0 0 1024 1024" fill="none">
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"
                    transform="scale(64)"
                    fill="#CCCCCC"
                  />
                </svg>
              </a>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Tweaked from https://tailwindcss.com/plus/ui-blocks/ecommerce/components/product-quickviews -->
    <div class="flex min-h-full items-stretch justify-center text-center md:items-center md:px-2 lg:px-4">
      <div class="flex w-full transform text-left text-base transition md:my-8 md:max-w-2xl md:px-4 lg:max-w-4xl">
        <div id="panel" class="relative flex w-full items-center overflow-hidden bg-white px-4 pb-8 pt-14 shadow-2xl sm:px-6 sm:pt-8 md:p-6 lg:p-8">
          <div class="grid w-full grid-cols-1 items-start gap-x-6 gap-y-8 sm:grid-cols-12 lg:gap-x-8">
            <img class="aspect-[2/3] w-full rounded-lg bg-gray-100 object-cover sm:col-span-4 lg:col-span-5" src="img/tshirt.png" />
            <div class="sm:col-span-8 lg:col-span-7">
              <h2 class="text-2xl font-bold text-gray-900 sm:pr-12">Basic Edgee Tee 6-Pack</h2>

              <section aria-labelledby="information-heading" class="mt-2">
                <h3 id="information-heading" class="sr-only">Product information</h3>

                <p class="text-2xl text-gray-900">$42.42</p>
              </section>

              <section aria-labelledby="options-heading" class="mt-10">
                <h3 id="options-heading" class="sr-only">Product options</h3>

                <form>
                  <button
                    type="button"
                    id="buy"
                    class="mt-6 flex w-full items-center justify-center rounded-md border border-transparent bg-gray-600 px-8 py-3 text-base font-medium text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                  >
                    Add to bag
                  </button>
                </form>
              </section>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Timer and Clear Button -->
    <div class="align-center flex justify-center">
      <div id="timer" class="hidden bg-blue-100 border border-blue-400 text-blue-700 px-4 py-2 rounded text-sm font-medium">Loading...</div>
      <button onclick="clearSiteData()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded text-sm font-medium transition-colors">
        Clear Data & Refresh
      </button>
    </div>
    <script type="text/javascript">
      // Start timer when page loads
      const startTime = performance.now();

      window.addEventListener("edgee:loaded", () => {
        const { KameleoonClient } = KameleoonSDK;

        const client = new KameleoonClient({
          siteCode: "p6cdkf9c3m",
          externals: {
            requester: edgee.getKameleoonRequester(),
          },
        });

        const buyButtonColorClassNames = {
          blue: ["bg-blue-400", "hover:bg-blue-500"],
          green: ["bg-green-400", "hover:bg-green-500"],
          red: ["bg-red-400", "hover:bg-red-500"],
        };
        const panelColorClassNames = {
          blue: ["bg-blue-100"],
          green: ["bg-green-100"],
          red: ["bg-red-100"],
        };

        async function init() {
          await client.initialize();

          const visitorCode = client.getVisitorCode();

          const variation = client.getVariation({
            visitorCode,
            featureKey: "test",
          });

          const siteName = variation.variables.get("site_name").value;
          const siteColor = variation.variables.get("site_color").value;
          const buttonColor = variation.variables.get("button_color").value;

          document.title = siteName;

          const panel = document.getElementById("panel");
          panel.classList.remove("bg-white");
          panel.classList.add(...panelColorClassNames[siteColor]);

          const buyButton = document.getElementById("buy");
          buyButton.classList.remove("bg-gray-600", "hover:bg-gray-700");
          buyButton.classList.add(...buyButtonColorClassNames[buttonColor]);
          buyButton.addEventListener("click", () => {
            client.trackConversion({
              visitorCode,
              goalId: 381988,
            });
          });

          // Calculate and display timer
          const endTime = performance.now();
          const loadTime = Math.round(endTime - startTime);
          const timerElement = document.getElementById("timer");
          if (timerElement) {
            timerElement.textContent = `Variation loaded in ${loadTime}ms (with Edgee)`;
            timerElement.classList.remove("hidden");
          }
        }
        init();
      });

      // Clear site data function
      function clearSiteData() {
        // Clear localStorage
        localStorage.clear();
        // Clear sessionStorage
        sessionStorage.clear();
        // Clear cookies
        document.cookie.split(";").forEach(function (c) {
          document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
        });
        // Refresh page
        window.location.reload();
      }
    </script>
  </body>
</html>
